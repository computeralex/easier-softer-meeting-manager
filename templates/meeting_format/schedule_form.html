{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Add Schedule{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        <i class="bi bi-calendar-event me-2"></i>Add Schedule
    </h1>
    <a href="{% url 'meeting_format:block_list' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i> Back
    </a>
</div>

<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    Variation: {{ variation.name }} ({{ variation.block.title }})
                </h6>
            </div>
            <div class="card-body">
                <form method="post" id="schedule-form">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label for="id_schedule_type" class="form-label">Schedule Type</label>
                        <select name="schedule_type" id="id_schedule_type" class="form-select" required>
                            <option value="">Select type...</option>
                            <option value="weekday_occurrence">Nth weekday of month (e.g., "3rd Tuesday")</option>
                            <option value="day_of_week">Every weekday (e.g., "Every Tuesday")</option>
                            <option value="specific_date">Specific date</option>
                        </select>
                    </div>

                    <div id="weekday-fields" style="display: none;">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="id_occurrence" class="form-label">Occurrence</label>
                                <select name="occurrence" id="id_occurrence" class="form-select">
                                    <option value="">Select...</option>
                                    <option value="1">1st</option>
                                    <option value="2">2nd</option>
                                    <option value="3">3rd</option>
                                    <option value="4">4th</option>
                                    <option value="5">5th</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_weekday" class="form-label">Day of Week</label>
                                <select name="weekday" id="id_weekday" class="form-select">
                                    <option value="">Select...</option>
                                    <option value="0">Monday</option>
                                    <option value="1">Tuesday</option>
                                    <option value="2">Wednesday</option>
                                    <option value="3">Thursday</option>
                                    <option value="4">Friday</option>
                                    <option value="5">Saturday</option>
                                    <option value="6">Sunday</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="date-field" class="mb-3" style="display: none;">
                        <label for="id_specific_date" class="form-label">Date</label>
                        <input type="date" name="specific_date" id="id_specific_date" class="form-control">
                    </div>

                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-lg me-1"></i> Add Schedule
                        </button>
                        <a href="{% url 'meeting_format:variation_update' variation.pk %}" class="btn btn-outline-secondary ms-2">Cancel</a>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-info-circle me-1"></i> Examples</h6>
            </div>
            <div class="card-body">
                <ul class="small text-muted mb-0">
                    <li><strong>Nth weekday:</strong> "1st Tuesday" = first Tuesday of each month</li>
                    <li><strong>Every weekday:</strong> "Every Tuesday" = every Tuesday</li>
                    <li><strong>Specific date:</strong> December 25, 2025 = just that date</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('id_schedule_type').addEventListener('change', function() {
    const weekdayFields = document.getElementById('weekday-fields');
    const dateField = document.getElementById('date-field');
    const occurrenceField = document.getElementById('id_occurrence');

    weekdayFields.style.display = 'none';
    dateField.style.display = 'none';
    occurrenceField.closest('.col-md-6').style.display = 'block';

    if (this.value === 'weekday_occurrence') {
        weekdayFields.style.display = 'block';
    } else if (this.value === 'day_of_week') {
        weekdayFields.style.display = 'block';
        occurrenceField.closest('.col-md-6').style.display = 'none';
    } else if (this.value === 'specific_date') {
        dateField.style.display = 'block';
    }
});
</script>
{% endblock %}
