<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone List - {{ meeting_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
            padding: 2rem;
        }
        .phone-list-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .contact-card {
            margin-bottom: 1rem;
        }
        .contact-name {
            font-weight: 600;
        }
        .sponsor-badge {
            background: #146c2e;
            font-size: 0.75rem;
        }
        .whatsapp-icon {
            color: #146c2e;
        }
        /* Table view styles */
        .table-view .sponsor-badge {
            padding: 2px 6px;
        }
        .table-view .whatsapp-badge {
            color: #146c2e;
            font-weight: bold;
        }
        /* Hidden items */
        .contact-item.hidden {
            display: none !important;
        }
        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
                font-size: 10pt;
            }
            .container {
                max-width: 100% !important;
                padding: 0 !important;
            }
            .no-print {
                display: none !important;
            }
            .card {
                border: none !important;
                box-shadow: none !important;
                margin-bottom: 0.25rem !important;
                break-inside: avoid;
            }
            .card-body {
                padding: 0.25rem 0 !important;
            }
            .contact-card {
                margin-bottom: 0.25rem !important;
            }
            .contact-name {
                font-size: 10pt;
            }
            .table-responsive {
                overflow: visible !important;
            }
            table {
                font-size: 9pt;
            }
            th, td {
                padding: 0.15rem 0.25rem !important;
            }
            .phone-list-header {
                margin-bottom: 0.5rem;
            }
            .phone-list-header h1 {
                font-size: 14pt;
                margin-bottom: 0;
            }
            .phone-list-header p {
                font-size: 10pt;
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="phone-list-header">
            <h1>{{ meeting_name }}</h1>
            <p class="text-muted">Phone List</p>
        </div>

        <!-- Controls -->
        <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2 no-print">
            <div class="d-flex gap-2 align-items-center flex-grow-1">
                <div class="input-group" style="max-width: 300px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="searchInput" placeholder="Search name, phone, email...">
                </div>
                <span class="text-muted small" id="resultCount"></span>
            </div>
            <div class="d-flex gap-2">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary btn-sm active" id="btnCards" onclick="setViewMode('cards')">
                        <i class="bi bi-grid-3x3-gap"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnTable" onclick="setViewMode('table')">
                        <i class="bi bi-list"></i>
                    </button>
                </div>
                <button onclick="window.print()" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-printer me-1"></i> Print
                </button>
            </div>
        </div>

        <!-- Cards View -->
        <div id="cardsView" class="row">
            {% for contact in contacts %}
            <div class="col-md-6 col-lg-4 contact-item"
                 data-name="{{ contact.name|lower }}"
                 data-phone="{{ contact.phone|lower }}"
                 data-email="{{ contact.email|lower }}">
                <div class="card contact-card">
                    <div class="card-body">
                        <h6 class="contact-name mb-1">
                            {{ contact.name }}
                            {% if contact.available_to_sponsor %}
                            <span class="badge sponsor-badge ms-1">Sponsor</span>
                            {% endif %}
                        </h6>
                        {% if contact.phone %}
                        <div class="small">
                            <i class="bi bi-telephone me-1"></i>
                            <a href="tel:{{ contact.phone }}" class="text-decoration-none">{{ contact.phone }}</a>
                            {% if contact.has_whatsapp %}
                            <i class="bi bi-whatsapp whatsapp-icon ms-1" title="WhatsApp"></i>
                            {% endif %}
                        </div>
                        {% endif %}
                        {% if contact.email %}
                        <div class="small">
                            <i class="bi bi-envelope me-1"></i>
                            <a href="mailto:{{ contact.email }}" class="text-decoration-none">{{ contact.email }}</a>
                        </div>
                        {% endif %}
                        {% if contact.time_zone or contact.time_zone_other %}
                        <div class="small text-muted">
                            <i class="bi bi-clock me-1"></i> {% if contact.time_zone %}{{ contact.time_zone.display_name }}{% else %}{{ contact.time_zone_other }}{% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    No contacts available.
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Table View -->
        <div id="tableView" class="table-view" style="display: none;">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Name / Sponsor?</th>
                            <th>Phone / WhatsApp?</th>
                            <th>Email</th>
                            <th>Time Zone</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for contact in contacts %}
                        <tr class="contact-item"
                            data-name="{{ contact.name|lower }}"
                            data-phone="{{ contact.phone|lower }}"
                            data-email="{{ contact.email|lower }}">
                            <td>
                                {{ contact.name }}
                                {% if contact.available_to_sponsor %}
                                <span class="badge sponsor-badge ms-1">S</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if contact.phone %}
                                <a href="tel:{{ contact.phone }}" class="text-decoration-none">{{ contact.phone }}</a>
                                {% if contact.has_whatsapp %}
                                <span class="whatsapp-badge ms-1">W</span>
                                {% endif %}
                                {% else %}-{% endif %}
                            </td>
                            <td>
                                {% if contact.email %}
                                <a href="mailto:{{ contact.email }}" class="text-decoration-none">{{ contact.email }}</a>
                                {% else %}-{% endif %}
                            </td>
                            <td>{% if contact.time_zone %}{{ contact.time_zone.display_name }}{% elif contact.time_zone_other %}{{ contact.time_zone_other }}{% else %}-{% endif %}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">No contacts available.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-center text-muted mt-4 small no-print">
            <p>{{ config.pdf_footer_text|default:"This phone list is for meeting members only. Please respect everyone's privacy." }}</p>
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const resultCount = document.getElementById('resultCount');
        const cardsView = document.getElementById('cardsView');
        const tableView = document.getElementById('tableView');
        const btnCards = document.getElementById('btnCards');
        const btnTable = document.getElementById('btnTable');

        // Search functionality
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            const items = document.querySelectorAll('.contact-item');
            let visibleCount = 0;

            items.forEach(item => {
                const name = item.dataset.name || '';
                const phone = item.dataset.phone || '';
                const email = item.dataset.email || '';

                if (!query || name.includes(query) || phone.includes(query) || email.includes(query)) {
                    item.classList.remove('hidden');
                    visibleCount++;
                } else {
                    item.classList.add('hidden');
                }
            });

            // Update count - divide by 2 since we have items in both views
            const totalItems = items.length / 2;
            visibleCount = visibleCount / 2;
            if (query) {
                resultCount.textContent = `${visibleCount} of ${totalItems}`;
            } else {
                resultCount.textContent = '';
            }
        });

        // View mode toggle
        function setViewMode(mode) {
            if (mode === 'table') {
                cardsView.style.display = 'none';
                tableView.style.display = 'block';
                btnCards.classList.remove('active');
                btnTable.classList.add('active');
            } else {
                cardsView.style.display = 'flex';
                tableView.style.display = 'none';
                btnCards.classList.add('active');
                btnTable.classList.remove('active');
            }
            localStorage.setItem('phoneListViewMode', mode);
        }

        // Restore view mode from localStorage
        const savedMode = localStorage.getItem('phoneListViewMode');
        if (savedMode) {
            setViewMode(savedMode);
        }
    </script>
</body>
</html>
